<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Snapth TikTok Downloader</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
  <h1>Tải video TikTok</h1>

  <!-- Form nhập link -->
  <form id="downloadForm">
    <input type="text" id="tiktokUrl" placeholder="Dán link TikTok vào đây..." />
    <button type="submit">Tải xuống</button>
  </form>

  <!-- Hiển thị kết quả -->
  <div id="resultBox"></div>
<script src="main.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const form = document.getElementById("downloadForm");
      const input = document.getElementById("tiktokUrl");
      const resultBox = document.getElementById("resultBox");

      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        const url = input.value.trim();
        if (!url) return alert("Vui lòng nhập link TikTok.");
        resultBox.innerHTML = "⏳ Đang xử lý...";

        try {
          const res = await fetch("/api/tiktok", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              "Authorization": "Bearer my_super_secret_token_123"
            },
            body: JSON.stringify({ url })
          });

          const data = await res.json();
          console.log("API trả về:", data);

          if (!data.video) {
            resultBox.innerHTML = "❌ Không lấy được video.";
            return;
          }

          resultBox.innerHTML = `
            <button onclick="forceDownload('${data.video}', '${data.filename}')">
              ⬇️ Tải video
            </button>
          `;
        } catch (err) {
          console.error("Lỗi:", err);
          resultBox.innerHTML = "⚠️ Lỗi kết nối tới API.";
        }
      });
    });

    function forceDownload(url, filename) {
      const a = document.createElement("a");
      a.href = url;
      a.setAttribute("download", filename || "video.mp4");
      document.body.appendChild(a);
      a.click();
      a.remove();
    }
  </script>
</body>
</html>
