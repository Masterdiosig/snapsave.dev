<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Snapsave.cfd – Tải video TikTok không logo</title>
  <meta name="description" content="Dán link TikTok để tải video không logo, tốc độ nhanh, miễn phí." />
  <link rel="stylesheet" href="./style.css" />
</head>
<body>
  <header class="header">
    <div class="brand">
      <span class="logo">⬇️</span>
      <h1>Snapsave <b>cfd</b></h1>
    </div>
    <button class="menu" aria-label="Open menu">☰</button>
  </header>

  <aside id="sidebar" class="sidebar">
    <nav>
      <a href="/">Trang chủ</a>
      <a href="#faq">Hỏi đáp</a>
      <a href="mailto:singerkaseem@gmail.com">Liên hệ</a>
    </nav>
  </aside>
  <div id="overlay" class="overlay"></div>

  <main class="container">
    <section class="hero">
      <h2>Tải video TikTok không logo</h2>
      <p>Dán link TikTok vào ô dưới và bấm <b>Tải</b>. Không cần cài app.</p>

      <div id="error-inline" class="alert" style="display:none;">
        <span id="error-inline-msg"></span>
      </div>

      <!-- Chỉ giữ 1 form -->
      <form id="downloadForm" class="form">
        <input type="url" id="tiktokUrl" placeholder="Paste TikTok link here..." required />
        <button type="submit">Tải</button>
      </form>

      <div id="resultBox"></div>

      <div class="samples">
        <p>Ví dụ:</p>
        <button class="sample" data-url="https://www.tiktok.com/@scout2015/video/6718335390845095173">Link mẫu 1</button>
        <button class="sample" data-url="https://vm.tiktok.com/ZM2xYxxx/">Link rút gọn</button>
      </div>
    </section>

    <section id="faq" class="faq">
      <h2>Hỏi đáp</h2>
      <div class="faq-item">
        <button class="faq-question">Tại sao tải chậm?</button>
        <div class="faq-answer">
          Tụi mình parse trực tiếp TikTok, không qua trung gian và có cache 10 phút, nên thường hiển thị tức thì. Nếu link mới, lần đầu có thể mất 1–2 giây.
        </div>
      </div>
      <div class="faq-item">
        <button class="faq-question">Có miễn phí không?</button>
        <div class="faq-answer">Có. Bạn có thể dùng thoải mái.</div>
      </div>
    </section>
  </main>

  <footer class="footer">
    © <span id="y"></span> Snapsave.cfd — Không liên kết với TikTok.
  </footer>

  
  <script>
  // Sidebar menu toggle
  const menuBtn = document.querySelector('.menu');
  const sidebar = document.getElementById('sidebar');
  const overlay = document.getElementById('overlay');

  menuBtn.addEventListener('click', () => {
    sidebar.classList.toggle('active');
    overlay.classList.toggle('active');
  });

  overlay.addEventListener('click', () => {
    sidebar.classList.remove('active');
    overlay.classList.remove('active');
  });

  // FAQ toggle
  document.querySelectorAll('.faq-question').forEach(btn => {
    btn.addEventListener('click', () => {
      const item = btn.parentElement;
      item.classList.toggle('active');
    });
  });

  // Sample buttons
  document.querySelectorAll('.sample').forEach(btn => {
    btn.addEventListener('click', () => {
      const url = btn.dataset.url;
      document.getElementById('tiktokUrl').value = url;
      document.getElementById('downloadForm').dispatchEvent(new Event('submit', {cancelable: true, bubbles: true}));
    });
  });

  // Download form
   document.getElementById("downloadForm").addEventListener("submit", async function(e) {
    e.preventDefault();
    const url = document.getElementById("tiktokUrl").value.trim();
    const resultBox = document.getElementById("resultBox");
    if (!url) return alert("Vui lòng nhập link TikTok.");

    resultBox.innerHTML = "⏳ Đang xử lý...";

    try {
      const res = await fetch('/api/tiktok', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': 'Bearer my_super_secret_token_123'
        },
        body: JSON.stringify({ url })
      });

      const data = await res.json();

      if (data.code !== 0 || !data.data || data.data.length === 0) {
        resultBox.innerHTML = "❌ Không lấy được video. Vui lòng thử lại.";
        return;
      }

      const metaHTML = `
        ${data.meta.thumbnail ? `<img src="${data.meta.thumbnail}" alt="Thumbnail" class="thumbnail" />` : ""}
        ${data.meta.author ? `<div class="author">@${data.meta.author}</div>` : ""}
        ${data.meta.description ? `<div class="desc">${data.meta.description}</div>` : ""}
      `;

      const buttonsHTML = data.data.map((item, index) => `
        <button class="button-go" onclick="forceDownload('${item.url}', 'video-${index+1}.mp4')">${item.label}</button>
      `).join("");

      resultBox.innerHTML = metaHTML + buttonsHTML;

    } catch (err) {
      console.error("⚠️ Lỗi fetch:", err);
      resultBox.innerHTML = "⚠️ Lỗi kết nối đến API.";
    }
  });
     // Force download helper
  async function forceDownload(url, filename) {
    try {
      const res = await fetch(url);
      const blob = await res.blob();
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      a.remove();
    } catch (err) {
      alert("❌ Không tải được video: " + err.message);
    }
  }
</script>
</body>
</html>
